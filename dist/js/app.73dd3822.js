(function(e){function t(t){for(var c,n,s=t[0],i=t[1],l=t[2],b=0,d=[];b<s.length;b++)n=s[b],Object.prototype.hasOwnProperty.call(o,n)&&o[n]&&d.push(o[n][0]),o[n]=0;for(c in i)Object.prototype.hasOwnProperty.call(i,c)&&(e[c]=i[c]);u&&u(t);while(d.length)d.shift()();return r.push.apply(r,l||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],c=!0,n=1;n<a.length;n++){var s=a[n];0!==o[s]&&(c=!1)}c&&(r.splice(t--,1),e=i(i.s=a[0]))}return e}var c={},n={app:0},o={app:0},r=[];function s(e){return i.p+"js/"+({login:"login",editor:"editor"}[e]||e)+"."+{login:"87d19cf2",editor:"7f55ca14"}[e]+".js"}function i(t){if(c[t])return c[t].exports;var a=c[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.e=function(e){var t=[],a={login:1,editor:1};n[e]?t.push(n[e]):0!==n[e]&&a[e]&&t.push(n[e]=new Promise((function(t,a){for(var c="css/"+({login:"login",editor:"editor"}[e]||e)+"."+{login:"3900ca02",editor:"dc3d6c3e"}[e]+".css",o=i.p+c,r=document.getElementsByTagName("link"),s=0;s<r.length;s++){var l=r[s],b=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(b===c||b===o))return t()}var d=document.getElementsByTagName("style");for(s=0;s<d.length;s++){l=d[s],b=l.getAttribute("data-href");if(b===c||b===o)return t()}var u=document.createElement("link");u.rel="stylesheet",u.type="text/css",u.onload=t,u.onerror=function(t){var c=t&&t.target&&t.target.src||o,r=new Error("Loading CSS chunk "+e+" failed.\n("+c+")");r.code="CSS_CHUNK_LOAD_FAILED",r.request=c,delete n[e],u.parentNode.removeChild(u),a(r)},u.href=o;var p=document.getElementsByTagName("head")[0];p.appendChild(u)})).then((function(){n[e]=0})));var c=o[e];if(0!==c)if(c)t.push(c[2]);else{var r=new Promise((function(t,a){c=o[e]=[t,a]}));t.push(c[2]=r);var l,b=document.createElement("script");b.charset="utf-8",b.timeout=120,i.nc&&b.setAttribute("nonce",i.nc),b.src=s(e);var d=new Error;l=function(t){b.onerror=b.onload=null,clearTimeout(u);var a=o[e];if(0!==a){if(a){var c=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+c+": "+n+")",d.name="ChunkLoadError",d.type=c,d.request=n,a[1](d)}o[e]=void 0}};var u=setTimeout((function(){l({type:"timeout",target:b})}),12e4);b.onerror=b.onload=l,document.head.appendChild(b)}return Promise.all(t)},i.m=e,i.c=c,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)i.d(a,c,function(t){return e[t]}.bind(null,c));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],b=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var u=b;r.push([0,"npm..pnpm"]),a()})({0:function(e,t,a){e.exports=a("cd49")},"0287":function(e,t,a){},"04e4":function(e,t,a){"use strict";a("7fdc")},"13ec":function(e,t,a){"use strict";a.d(t,"b",(function(){return b})),a.d(t,"a",(function(){return d})),a.d(t,"e",(function(){return u})),a.d(t,"i",(function(){return p})),a.d(t,"h",(function(){return O})),a.d(t,"j",(function(){return j})),a.d(t,"k",(function(){return m})),a.d(t,"d",(function(){return f})),a.d(t,"g",(function(){return h})),a.d(t,"f",(function(){return g})),a.d(t,"c",(function(){return k}));a("668c"),a("ae9b"),a("3ec3"),a("b0a1"),a("558b");var c=a("596a"),n=a("07d8"),o=a("25e1"),r=a.n(o),s=a("e7dc"),i=a("030d");function l(e,t){const{format:a,size:c}=t,n=!a||a.includes(e.type),o=!c||e.size/1024/1024<c;let r=null;return n||(r="format"),o||(r="size"),{passed:n&&o,error:r}}const b=e=>{const t=l(e,{format:["image/jpeg","image/png"],size:1}),{passed:a,error:n}=t;return"format"===n&&c["a"].error("上传图片只能是 JPG/PNG 格式!"),"size"===n&&c["a"].error("上传图片大小不能超过 1Mb"),a};function d(e,t){let a=e.target;if(a.classList.contains(t))return a;while(a){if(a.classList&&a.classList.contains(t))return a;a=a.parentNode}return!1}const u=e=>new Promise((t,a)=>{const c=new Image;c.src=URL.createObjectURL(e),c.onload=()=>{const{naturalWidth:e,naturalHeight:a}=c;t({width:e,height:a})},c.onerror=()=>{a(new Error("There was some problem with the image."))}});const p=e=>{const t=document.getElementById(e);return r()(t,{allowTaint:!1,useCORS:!0,width:375}).then(e=>new Promise((t,a)=>{e.toBlob(e=>{if(e){const c=new File([e],"screenshot.png"),o=new FormData;o.append("file",c),n["a"].post("/utils/upload-img",o,{headers:{"Content-Type":"multipart/form-data"},timeout:5e3}).then(e=>{t(e.data)}).catch(e=>{a(e)})}else a(new Error("blob data error"))},"image/png")}))},O=e=>Object(i["a"])(e,(e,t)=>`${t}=${e}`).join("&"),j=e=>e.toISOString().split("T")[0],m=(e,t)=>{const a=new Date(e.getTime());return a.setDate(e.getDate()+t),a},f=(e,t)=>{const a=[];for(let c=new Date(e);c<=t;c.setDate(c.getDate()+1))a.push(new Date(c));return a},h=e=>Object.keys(e).map(t=>e[t]),g=(e,t,a)=>[...e.slice(0,t),a,...e.slice(t)],k=e=>{const t=e.substring(e.lastIndexOf("/")+1);Object(s["saveAs"])(e,t)}},1506:function(e,t,a){"use strict";a("baba")},"2b61":function(e,t,a){},"30b3":function(e,t,a){e.exports=a.p+"img/background.3744875e.png"},"30c5":function(e,t,a){},"344d":function(e,t,a){"use strict";a("ebac")},"407b":function(e,t,a){},"42f2":function(e,t,a){"use strict";a("407b")},"5acd":function(e,t,a){},"6bc0":function(e,t,a){"use strict";a("5acd")},"7b59":function(e,t,a){"use strict";a("30c5")},"7fdc":function(e,t,a){},"8dbf":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return r})),a.d(t,"d",(function(){return s}));var c=a("ae51");function n(e){return Object(c["a"])({url:"/users/genVeriCode",method:"post",data:{emailAddress:e}})}function o(e){return Object(c["a"])({url:"/users/loginByPhoneNumber",method:"post",data:e})}function r(){return Object(c["a"])({url:"/users/getUserInfo",method:"get"})}function s(e){return Object(c["a"])({url:"/users/updateUserInfo",method:"patch",data:e})}},9897:function(e,t,a){"use strict";var c=a("b6f3"),n=a("3955"),o=a("596a");function r(){const e=Object(c["b"])(),t=Object(n["i"])(()=>e.state.status.error);Object(n["db"])(()=>t.value.status,e=>{e&&o["a"].error(t.value.message,2)})}t["a"]=r},"9f73":function(e,t,a){"use strict";var c=a("3955");function n(e,t,a,n,o,r){const s=Object(c["S"])("router-link"),i=Object(c["S"])("a-button"),l=Object(c["S"])("a-menu-item"),b=Object(c["S"])("a-menu"),d=Object(c["S"])("a-dropdown-button");return e.user.isLogin?(Object(c["J"])(),Object(c["m"])("div",{key:1,class:Object(c["A"])({"user-operation":!e.smMode})},[e.smMode?Object(c["l"])("",!0):(Object(c["J"])(),Object(c["k"])(i,{key:0,type:"primary",onClick:e.createDesign,style:{"border-radius":"20px"}},{default:Object(c["fb"])(()=>[Object(c["p"])(" 创建设计 ")]),_:1},8,["onClick"])),e.smMode?Object(c["l"])("",!0):(Object(c["J"])(),Object(c["k"])(i,{key:1,type:"primary",class:"user-profile-component",style:{"border-radius":"20px"}},{default:Object(c["fb"])(()=>[Object(c["q"])(s,{to:"/mywork"},{default:Object(c["fb"])(()=>[Object(c["p"])("我的作品")]),_:1})]),_:1})),Object(c["q"])(d,{class:"user-profile-component"},{overlay:Object(c["fb"])(()=>[Object(c["q"])(b,{class:"user-profile-dropdown"},{default:Object(c["fb"])(()=>[e.smMode?(Object(c["J"])(),Object(c["k"])(l,{key:"2"},{default:Object(c["fb"])(()=>[Object(c["q"])(s,{to:"/mywork"},{default:Object(c["fb"])(()=>[Object(c["p"])("我的作品")]),_:1})]),_:1})):Object(c["l"])("",!0),Object(c["q"])(l,{key:"3"},{default:Object(c["fb"])(()=>[Object(c["q"])(s,{to:"/setting"},{default:Object(c["fb"])(()=>[Object(c["p"])("个人设置")]),_:1})]),_:1}),Object(c["q"])(l,{key:"4",onClick:e.logout},{default:Object(c["fb"])(()=>[Object(c["p"])("登出")]),_:1},8,["onClick"])]),_:1})]),default:Object(c["fb"])(()=>[Object(c["q"])(s,{to:"/setting"},{default:Object(c["fb"])(()=>[Object(c["p"])(Object(c["W"])(e.user.data.nickName),1)]),_:1})]),_:1})],2)):(Object(c["J"])(),Object(c["k"])(i,{key:0,type:"primary",class:"user-profile-component"},{default:Object(c["fb"])(()=>[Object(c["q"])(s,{to:"/login"},{default:Object(c["fb"])(()=>[Object(c["p"])("登录")]),_:1})]),_:1}))}a("558b");var o=a("b6f3"),r=a("9a86"),s=a("596a"),i=a("f7f2"),l=Object(c["r"])({name:"user-profile",props:{user:{type:Object,required:!0},smMode:{type:Boolean,default:!1}},setup(){const e=Object(o["b"])(),t=Object(r["e"])(),a=Object(i["a"])(),c=()=>{e.commit("logout"),s["a"].success("退出登录成功，2秒后跳转到首页",2),setTimeout(()=>{t.push("/login")},2e3)};return{logout:c,createDesign:a}}}),b=(a("b24a"),a("85dd")),d=a.n(b);const u=d()(l,[["render",n]]);t["a"]=u},a5d7:function(e,t,a){"use strict";a("0287")},ae51:function(e,t,a){"use strict";var c=a("07d8");const n=c["a"].create({withCredentials:!0,timeout:5e4,baseURL:"/api"});n.interceptors.request.use(async e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer "+t),e},e=>Promise.reject(e)),n.interceptors.response.use(e=>(e.data.result,e.data),e=>e.response),t["a"]=n},b24a:function(e,t,a){"use strict";a("2b61")},baba:function(e,t,a){},cd49:function(e,t,a){"use strict";a.r(t),a.d(t,"baseBackendURL",(function(){return aa})),a.d(t,"baseH5URL",(function(){return ca})),a.d(t,"baseStaticURL",(function(){return na}));var c=a("3955"),n=a("07d8"),o=a("6ee3"),r=a("8ece"),s=a("c602"),i=a("efab"),l=a("1587"),b=a("1926"),d=a("a239"),u=a("7b2c"),p=a("8156"),O=a("b898"),j=a("63f3"),m=a("bb20"),f=a("3ef6"),h=a("61de"),g=a("75a8"),k=a("99b7"),y=a("5a5d"),v=a("3202"),S=a("15d8");const w=[o["a"],r["a"],s["a"],i["a"],l["a"],b["a"],b["a"].Meta,d["a"],u["a"],u["a"].Header,u["a"].Footer,u["a"].Sider,u["a"].Content,p["a"],p["a"].TabPane,O["a"],O["a"].Item,j["a"],m["a"],f["a"],f["a"].Item,h["a"],h["a"].Button,g["a"],k["a"],g["a"].TextArea,y["a"],v["a"].Group,v["a"].Button,S["a"],S["a"].Option],x=e=>{w.forEach(t=>{e.component(t.name,t)})};var C={install:x},_=a("5cce");a("4b80");const q={id:"app"};function I(e,t){const a=Object(c["S"])("router-view");return Object(c["J"])(),Object(c["m"])("div",q,[Object(c["q"])(a)])}var T=a("85dd"),D=a.n(T);const W={},P=D()(W,[["render",I]]);var J=P,L=a("9a86"),U=a("cf05"),E=a.n(U);const z=e=>(Object(c["M"])("data-v-6ad93b2b"),e=e(),Object(c["K"])(),e),A={class:"homepage-container"},N=z(()=>Object(c["n"])("div",{class:"page-title"},[Object(c["n"])("img",{src:E.a,class:"logo-img"}),Object(c["p"])(" 海报大师 ")],-1));function M(e,t,a,n,o,r){const s=Object(c["S"])("a-spin"),i=Object(c["S"])("user-profile"),l=Object(c["S"])("a-layout-header"),b=Object(c["S"])("router-view"),d=Object(c["S"])("a-layout-content"),u=Object(c["S"])("a-layout"),p=Object(c["S"])("a-layout-footer");return Object(c["J"])(),Object(c["m"])("div",A,[e.loading?(Object(c["J"])(),Object(c["k"])(s,{key:0,tip:"读取中",class:"editor-spinner"})):Object(c["l"])("",!0),Object(c["q"])(u,{style:{background:"#fff"}},{default:Object(c["fb"])(()=>[Object(c["q"])(l,{class:"header"},{default:Object(c["fb"])(()=>[N,Object(c["q"])(i,{user:e.userInfo},null,8,["user"])]),_:1}),e.isHomePage?(Object(c["J"])(),Object(c["k"])(d,{key:0,class:"home-layout"},{default:Object(c["fb"])(()=>[Object(c["q"])(b)]),_:1})):(Object(c["J"])(),Object(c["k"])(d,{key:1,style:{padding:"0 50px"}},{default:Object(c["fb"])(()=>[Object(c["q"])(u,{style:{padding:"24px 0",background:"#fff"}},{default:Object(c["fb"])(()=>[Object(c["q"])(d,{style:{padding:"0 24px",minHeight:"85vh",maxWidth:"1200px",margin:"0 auto",width:"100%"}},{default:Object(c["fb"])(()=>[Object(c["q"])(b)]),_:1})]),_:1})]),_:1})),Object(c["q"])(p,null,{default:Object(c["fb"])(()=>[Object(c["p"])(" © Liang版权所有 | 津TPC备 ")]),_:1})]),_:1})])}var B=a("b6f3"),R=a("9f73"),H=a("f7f2"),F=a("9897"),G=Object(c["r"])({components:{UserProfile:R["a"]},setup(){const e=Object(B["b"])(),t=Object(L["d"])(),a=Object(c["i"])(()=>"Home"===t.name),n=Object(c["i"])(()=>e.state.user),o=Object(c["i"])(()=>e.state.status.loading),r=Object(H["a"])();return Object(F["a"])(),{userInfo:n,createDesign:r,loading:o,isHomePage:a}}});a("04e4");const $=D()(G,[["render",M],["__scopeId","data-v-6ad93b2b"]]);var K=$,V=a("30b3"),Y=a.n(V);const Q={class:"homepage-container"},Z={class:"banner"},X=Object(c["n"])("img",{class:"banner-img",src:Y.a,style:{"background-color":"rgb(0, 0, 0)"}},null,-1),ee={class:"banner-text"},te=Object(c["n"])("h2",{class:"text-headline",style:{color:"rgb(255, 255, 255)"}},"海量精彩设计 一键生成",-1),ae={class:"welcome-container"},ce={class:"welcome-container-inner"},ne=Object(c["n"])("h3",null,"专注H5 始终如一",-1),oe=Object(c["n"])("p",null,"三年保持行业领先",-1),re=Object(c["n"])("h3",null,"海量 H5 模版",-1),se=Object(c["n"])("p",null,"一键生成，一分钟轻松制作",-1),ie=Object(c["n"])("h3",null,"极致体验",-1),le=Object(c["n"])("p",null,"用户的一致选择",-1),be={class:"content-container"},de={key:0},ue={key:2,class:"hot-title"},pe=Object(c["n"])("h2",{class:"hot-template"},"热门海报",-1),Oe=Object(c["n"])("p",null,"只需替换文字和图片，一键自动生成H5",-1),je=[pe,Oe],me=Object(c["n"])("span",null," 没找到任何海报 换个关键词试试 ",-1),fe={key:0,class:"my-works"},he=Object(c["n"])("h2",null,"我的作品",-1);function ge(e,t,a,n,o,r){const s=Object(c["S"])("a-input-search"),i=Object(c["S"])("Html5TwoTone"),l=Object(c["S"])("a-col"),b=Object(c["S"])("BuildTwoTone"),d=Object(c["S"])("BulbTwoTone"),u=Object(c["S"])("a-row"),p=Object(c["S"])("a-button"),O=Object(c["S"])("a-empty"),j=Object(c["S"])("template-list"),m=Object(c["S"])("router-link");return Object(c["J"])(),Object(c["m"])("div",Q,[Object(c["n"])("div",Z,[X,Object(c["n"])("div",ee,[te,Object(c["q"])(s,{value:e.searchText,"onUpdate:value":t[0]||(t[0]=t=>e.searchText=t),placeholder:"搜索一下，快速找模版","enter-button":"",onSearch:e.onSearch},null,8,["value","onSearch"])])]),Object(c["n"])("div",ae,[Object(c["n"])("div",ce,[Object(c["q"])(u,null,{default:Object(c["fb"])(()=>[Object(c["q"])(l,{span:8,class:"feature-item"},{default:Object(c["fb"])(()=>[Object(c["q"])(i),ne,oe]),_:1}),Object(c["q"])(l,{span:8,class:"feature-item"},{default:Object(c["fb"])(()=>[Object(c["q"])(b),re,se]),_:1}),Object(c["q"])(l,{span:8,class:"feature-item"},{default:Object(c["fb"])(()=>[Object(c["q"])(d),ie,le]),_:1})]),_:1})])]),Object(c["n"])("div",be,[Object(c["q"])(u,{class:"content-title",type:"flex",align:"middle"},{default:Object(c["fb"])(()=>[e.currentSearchText?(Object(c["J"])(),Object(c["m"])("h2",de,Object(c["W"])(e.currentSearchText)+"的结果",1)):Object(c["l"])("",!0),e.currentSearchText?(Object(c["J"])(),Object(c["k"])(p,{key:1,shape:"circle",size:"small",style:{marginLeft:"10px"},onClick:e.clearSearch},{default:Object(c["fb"])(()=>[Object(c["p"])(" × ")]),_:1},8,["onClick"])):(Object(c["J"])(),Object(c["m"])("div",ue,je))]),_:1}),Object(c["q"])(u,{gutter:16},{default:Object(c["fb"])(()=>[0!==e.templates.length||e.loading?Object(c["l"])("",!0):(Object(c["J"])(),Object(c["k"])(O,{key:0},{description:Object(c["fb"])(()=>[me]),_:1})),Object(c["q"])(j,{list:e.templates,type:"template"},null,8,["list"])]),_:1}),Object(c["q"])(u,{type:"flex",justify:"center"},{default:Object(c["fb"])(()=>[e.isLastPage?Object(c["l"])("",!0):(Object(c["J"])(),Object(c["k"])(p,{key:0,type:"primary",size:"large",onClick:e.loadMorePage,loading:e.loading},{default:Object(c["fb"])(()=>[Object(c["p"])(" 加载更多 ")]),_:1},8,["onClick","loading"]))]),_:1}),e.isLogin&&e.works.length>0?(Object(c["J"])(),Object(c["m"])("div",fe,[Object(c["q"])(u,{type:"flex",justify:"space-between",align:"middle",class:"content-title"},{default:Object(c["fb"])(()=>[he,Object(c["q"])(m,{to:"/mywork"},{default:Object(c["fb"])(()=>[Object(c["p"])("查看我的所有作品")]),_:1})]),_:1}),Object(c["q"])(u,{gutter:16},{default:Object(c["fb"])(()=>[Object(c["q"])(j,{list:e.works},null,8,["list"])]),_:1})])):Object(c["l"])("",!0)])])}const ke={class:"template-list-component"},ye=["src"],ve={key:1,src:"http://typescript-vue.oss-cn-beijing.aliyuncs.com/vue-marker/5f81cca3f3bf7a0e1ebaf885.png"},Se={class:"hover-item"},we={class:"description-detail"},xe={key:0},Ce={class:"user-number"},_e={class:"tag-list"};function qe(e,t,a,n,o,r){const s=Object(c["S"])("a-button"),i=Object(c["S"])("UserOutlined"),l=Object(c["S"])("a-card-meta"),b=Object(c["S"])("a-card"),d=Object(c["S"])("a-tag"),u=Object(c["S"])("router-link"),p=Object(c["S"])("a-col"),O=Object(c["S"])("a-row");return Object(c["J"])(),Object(c["m"])("div",ke,[Object(c["q"])(O,{gutter:16},{default:Object(c["fb"])(()=>[(Object(c["J"])(!0),Object(c["m"])(c["b"],null,Object(c["Q"])(e.list,t=>(Object(c["J"])(),Object(c["k"])(p,{span:6,key:t.id,class:"poster-item"},{default:Object(c["fb"])(()=>[Object(c["q"])(u,{to:"work"===e.type?"/editor/"+t.id:"/template/"+t.id},{default:Object(c["fb"])(()=>[Object(c["q"])(b,{hoverable:""},{cover:Object(c["fb"])(()=>[t.coverImg?(Object(c["J"])(),Object(c["m"])("img",{key:0,src:t.coverImg},null,8,ye)):(Object(c["J"])(),Object(c["m"])("img",ve)),Object(c["n"])("div",Se,[Object(c["q"])(s,{size:"large",type:"primary"},{default:Object(c["fb"])(()=>[Object(c["p"])(Object(c["W"])("work"===e.type?"编辑该作品":"使用该模版创建"),1)]),_:1})])]),default:Object(c["fb"])(()=>[Object(c["q"])(l,{title:t.title},{description:Object(c["fb"])(()=>[Object(c["n"])("div",we,[t.user?(Object(c["J"])(),Object(c["m"])("span",xe,"作者："+Object(c["W"])(t.user.nickName),1)):Object(c["l"])("",!0),Object(c["n"])("span",Ce,[Object(c["q"])(i),Object(c["p"])(" "+Object(c["W"])(t.copiedCount),1)])])]),_:2},1032,["title"])]),_:2},1024),Object(c["n"])("div",_e,[t.isHot?(Object(c["J"])(),Object(c["k"])(d,{key:0,color:"red"},{default:Object(c["fb"])(()=>[Object(c["p"])(" HOT ")]),_:1})):Object(c["l"])("",!0),t.isNew?(Object(c["J"])(),Object(c["k"])(d,{key:1,color:"green"},{default:Object(c["fb"])(()=>[Object(c["p"])(" NEW ")]),_:1})):Object(c["l"])("",!0)])]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})])}var Ie=Object(c["r"])({name:"template-list",components:{},props:{list:{type:Array,required:!0},type:{type:String,default:"work"}}});a("344d");const Te=D()(Ie,[["render",qe]]);var De=Te;const We=(e,t,a={pageIndex:0,pageSize:8})=>{const n=Object(B["b"])(),o=Object(c["N"])(a),r=()=>{o.pageIndex++,n.dispatch(e,{searchParams:o})},s=t=>{o.pageIndex=t,n.dispatch(e,{searchParams:o})},i=()=>{o.pageIndex--,n.dispatch(e,{searchParams:o})},l=Object(c["i"])(()=>0===o.pageIndex),b=Object(c["i"])(()=>Math.ceil(t.value/a.pageSize)),d=Object(c["i"])(()=>b.value===o.pageIndex+1),u=Object(c["Z"])(o,"pageIndex");return{loadMorePage:r,isLastPage:d,pageIndex:u,loadPrevPage:i,isFirstPage:l,requestParams:o,goToPage:s,totalPage:b}};var Pe=We,Je=Object(c["r"])({components:{TemplateList:De},setup(){const e=Object(B["b"])(),t=Object(c["O"])(""),a=Object(c["i"])(()=>e.state.user.isLogin),n=Object(c["i"])(()=>e.state.works.works),o=Object(c["i"])(()=>e.state.works.templates),r=Object(c["i"])(()=>e.state.works.totalTemplates),s=Object(c["i"])(()=>e.state.status.loading),i=Object(c["i"])(()=>e.state.works.searchText),{loadMorePage:l,isLastPage:b}=Pe("fetchTemplates",r,{pageIndex:0,pageSize:8,title:t.value}),d=()=>{const a=t.value.trim();""===a&&""===i.value||e.dispatch("fetchTemplates",{title:a,pageIndex:0,pageSize:8})},u=()=>{e.dispatch("fetchTemplates",{title:"",pageIndex:0,pageSize:8})};return Object(c["G"])(()=>{a.value&&e.dispatch("fetchWorks",{pageIndex:0,pageSize:4}),e.dispatch("fetchTemplates",{pageIndex:0,pageSize:8})}),{isLogin:a,works:n,templates:o,loadMorePage:l,loading:s,isLastPage:b,searchText:t,onSearch:d,currentSearchText:i,clearSearch:u}}});a("a5d7");const Le=D()(Je,[["render",ge]]);var Ue=Le;const Ee={class:"mywork-container"},ze={id:"main-chart",style:{width:"600px",height:"400px"}},Ae={key:0,class:"searchResult"},Ne={key:1},Me=Object(c["n"])("span",null," 还没有任何作品 ",-1);function Be(e,t,a,n,o,r){const s=Object(c["S"])("a-range-picker"),i=Object(c["S"])("a-spin"),l=Object(c["S"])("a-table"),b=Object(c["S"])("a-modal"),d=Object(c["S"])("a-button"),u=Object(c["S"])("a-input-search"),p=Object(c["S"])("a-row"),O=Object(c["S"])("a-tab-pane"),j=Object(c["S"])("a-tabs"),m=Object(c["S"])("a-empty"),f=Object(c["S"])("works-list"),h=Object(c["S"])("a-pagination");return Object(c["J"])(),Object(c["m"])("div",Ee,[Object(c["q"])(b,{title:"数据统计",visible:e.showModal,"onUpdate:visible":t[0]||(t[0]=t=>e.showModal=t),width:"700px",footer:null},{default:Object(c["fb"])(()=>[Object(c["q"])(s,{value:e.dateRange,onChange:e.onDateChange,format:"YYYY-MM-DD"},null,8,["value","onChange"]),Object(c["n"])("div",ze,[e.loading?(Object(c["J"])(),Object(c["k"])(i,{key:0,size:"large",class:"chart-loading"})):Object(c["l"])("",!0)]),Object(c["q"])(l,{columns:e.tableColumns,"data-source":e.tableData},null,8,["columns","data-source"])]),_:1},8,["visible"]),Object(c["q"])(p,{type:"flex",justify:"space-between",align:"middle",class:"poster-title"},{default:Object(c["fb"])(()=>[e.currentSearchText?(Object(c["J"])(),Object(c["m"])("div",Ae,[Object(c["n"])("h2",null,Object(c["W"])(e.currentSearchText)+"的结果",1),Object(c["q"])(d,{shape:"circle",size:"small",style:{marginLeft:"10px"},onClick:e.clearSearch},{default:Object(c["fb"])(()=>[Object(c["p"])(" × ")]),_:1},8,["onClick"])])):(Object(c["J"])(),Object(c["m"])("h2",Ne,"我的作品和模版")),Object(c["q"])(u,{value:e.searchText,"onUpdate:value":t[1]||(t[1]=t=>e.searchText=t),placeholder:"搜索我的作品或者模版",onSearch:e.onSearch},null,8,["value","onSearch"])]),_:1}),Object(c["q"])(j,{onChange:e.changeCategory},{default:Object(c["fb"])(()=>[Object(c["q"])(O,{key:"0",tab:"我的作品"}),Object(c["q"])(O,{key:"1",tab:"我的模版"})]),_:1},8,["onChange"]),0!==e.works.length||e.loading?Object(c["l"])("",!0):(Object(c["J"])(),Object(c["k"])(m,{key:0},{description:Object(c["fb"])(()=>[Me]),default:Object(c["fb"])(()=>[Object(c["q"])(d,{type:"primary",size:"large",onClick:e.createDesign},{default:Object(c["fb"])(()=>[Object(c["p"])(" 创建你的第一个设计 🎉 ")]),_:1},8,["onClick"])]),_:1})),Object(c["q"])(f,{list:e.works,onOnDelete:e.onDelete,onOnCopy:e.onCopy,loading:e.loading,onOnStatic:e.openStatic,onOnSend:e.sendGift,"transfer-status":e.transferDone},null,8,["list","onOnDelete","onOnCopy","loading","onOnStatic","onOnSend","transfer-status"]),Object(c["q"])(p,{type:"flex",justify:"center"},{default:Object(c["fb"])(()=>[Object(c["q"])(h,{current:e.currentPage,"onUpdate:current":t[2]||(t[2]=t=>e.currentPage=t),total:e.total,pageSize:8,"show-less-items":"",onChange:e.pageChange},null,8,["current","total","onChange"])]),_:1})])}a("dc56"),a("558b");const Re={class:"template-list-component"},He=["src"],Fe={key:1,src:"http://typescript-vue.oss-cn-beijing.aliyuncs.com/vue-marker/5f81cca3f3bf7a0e1ebaf885.png"},Ge={class:"hover-item"},$e=["id"],Ke=["onClick"],Ve=["onClick"],Ye=["onClick"],Qe=["onClick"],Ze=["onClick"],Xe={class:"tag-list"};function et(e,t,a,n,o,r){const s=Object(c["S"])("UserOutlined"),i=Object(c["S"])("a-input"),l=Object(c["S"])("a-form-item"),b=Object(c["S"])("a-button"),d=Object(c["S"])("a-form"),u=Object(c["S"])("a-modal"),p=Object(c["S"])("a-skeleton"),O=Object(c["S"])("router-link"),j=Object(c["S"])("EditOutlined"),m=Object(c["S"])("BarChartOutlined"),f=Object(c["S"])("EllipsisOutlined"),h=Object(c["S"])("CopyOutlined"),g=Object(c["S"])("a-menu-item"),k=Object(c["S"])("DeleteOutlined"),y=Object(c["S"])("DownloadOutlined"),v=Object(c["S"])("GiftOutlined"),S=Object(c["S"])("a-menu"),w=Object(c["S"])("a-dropdown"),x=Object(c["S"])("a-card-meta"),C=Object(c["S"])("a-card"),_=Object(c["S"])("a-tag"),q=Object(c["S"])("a-col"),I=Object(c["S"])("a-row");return Object(c["J"])(),Object(c["m"])("div",Re,[Object(c["q"])(u,{title:"转赠作品",visible:e.sendModal,"onUpdate:visible":t[1]||(t[1]=t=>e.sendModal=t),footer:null},{default:Object(c["fb"])(()=>[Object(c["q"])(d,{model:e.form,rules:e.rules,ref:"publishForm",layout:"vertical"},{default:Object(c["fb"])(()=>[Object(c["q"])(l,{label:"用户名",required:"",name:"username"},{default:Object(c["fb"])(()=>[Object(c["q"])(i,{value:e.form.username,"onUpdate:value":t[0]||(t[0]=t=>e.form.username=t),placeholder:"填写要转赠人的用户名"},{prefix:Object(c["fb"])(()=>[Object(c["q"])(s,{style:{color:"rgba(0,0,0,.25)"}})]),_:1},8,["value"])]),_:1}),Object(c["q"])(l,null,{default:Object(c["fb"])(()=>[Object(c["q"])(b,{type:"primary",onClick:e.sendGift,size:"large",loading:e.loading},{default:Object(c["fb"])(()=>[Object(c["p"])(Object(c["W"])(e.loading?"加载中":"转赠该作品"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible"]),e.loading?(Object(c["J"])(),Object(c["k"])(p,{key:0})):(Object(c["J"])(),Object(c["k"])(I,{key:1,gutter:16},{default:Object(c["fb"])(()=>[(Object(c["J"])(!0),Object(c["m"])(c["b"],null,Object(c["Q"])(e.listWithBarcode,t=>(Object(c["J"])(),Object(c["k"])(q,{span:6,key:t.id,class:"poster-item"},{default:Object(c["fb"])(()=>[Object(c["q"])(C,{hoverable:"",onMouseenter:()=>e.showBarcode(t.id,t.barcodeUrl)},{cover:Object(c["fb"])(()=>[t.coverImg?(Object(c["J"])(),Object(c["m"])("img",{key:0,src:t.coverImg},null,8,He)):(Object(c["J"])(),Object(c["m"])("img",Fe)),Object(c["n"])("div",Ge,["2"===t.status?(Object(c["J"])(),Object(c["m"])("div",{key:0,id:"barcode-"+t.id,class:"barcode-container"},null,8,$e)):(Object(c["J"])(),Object(c["k"])(O,{key:1,to:"/editor/"+t.id},{default:Object(c["fb"])(()=>[Object(c["q"])(b,{size:"large",type:"primary"},{default:Object(c["fb"])(()=>[Object(c["p"])("继续编辑该作品")]),_:1})]),_:2},1032,["to"]))])]),actions:Object(c["fb"])(()=>[Object(c["q"])(O,{to:"/editor/"+t.id},{default:Object(c["fb"])(()=>[Object(c["q"])(j,{key:"edit"})]),_:2},1032,["to"]),"2"===t.status?(Object(c["J"])(),Object(c["m"])("a",{key:0,href:"javascript:;",onClick:Object(c["hb"])(a=>e.staticClicked(t.id),["prevent"])},[Object(c["q"])(m,{key:"chart"})],8,Ke)):Object(c["l"])("",!0),Object(c["q"])(w,null,{overlay:Object(c["fb"])(()=>[Object(c["q"])(S,{class:"overlay-dropdown"},{default:Object(c["fb"])(()=>[Object(c["q"])(g,null,{default:Object(c["fb"])(()=>[Object(c["n"])("a",{href:"javascript:;",onClick:Object(c["hb"])(a=>e.copyClicked(t.id),["prevent"])},[Object(c["q"])(h),Object(c["p"])(" 复制")],8,Ve)]),_:2},1024),Object(c["q"])(g,null,{default:Object(c["fb"])(()=>[Object(c["n"])("a",{href:"javascript:;",onClick:Object(c["hb"])(a=>e.deleteClicked(t.id),["prevent"])},[Object(c["q"])(k),Object(c["p"])(" 删除")],8,Ye)]),_:2},1024),t.coverImg?(Object(c["J"])(),Object(c["k"])(g,{key:0},{default:Object(c["fb"])(()=>[Object(c["n"])("a",{href:"javascript:;",onClick:Object(c["hb"])(a=>e.saveImage(t.coverImg),["prevent"])},[Object(c["q"])(y),Object(c["p"])(" 下载图片")],8,Qe)]),_:2},1024)):Object(c["l"])("",!0),Object(c["q"])(g,null,{default:Object(c["fb"])(()=>[Object(c["n"])("a",{href:"javascript:;",onClick:Object(c["hb"])(a=>e.sendClicked(t.id),["prevent"])},[Object(c["q"])(v),Object(c["p"])(" 转赠")],8,Ze)]),_:2},1024)]),_:2},1024)]),default:Object(c["fb"])(()=>[Object(c["q"])(f,{key:"ellipsis"})]),_:2},1024)]),default:Object(c["fb"])(()=>[Object(c["q"])(x,{title:t.title},null,8,["title"])]),_:2},1032,["onMouseenter"]),Object(c["n"])("div",Xe,["1"===t.status?(Object(c["J"])(),Object(c["k"])(_,{key:0,color:"red"},{default:Object(c["fb"])(()=>[Object(c["p"])(" 未发布 ")]),_:1})):(Object(c["J"])(),Object(c["k"])(_,{key:1,color:"green"},{default:Object(c["fb"])(()=>[Object(c["p"])(" 已发布 ")]),_:1}))])]),_:2},1024))),128))]),_:1}))])}var tt=a("7ef2"),at=a.n(tt),ct=a("13ec"),nt=Object(c["r"])({name:"works-list",emits:["on-copy","on-delete","on-static","on-send"],components:{},props:{list:{type:Array,required:!0},loading:{type:Boolean,default:!1},transferStatus:{type:Boolean,default:!1}},setup(e,t){const a=Object(c["O"])(null),n=Object(c["O"])(!1),o=Object(c["O"])(0),r=Object(c["O"])(),s=Object(c["i"])(()=>e.list.map(e=>(e.barcodeUrl=`${ca}/p/${e.id}-${e.uuid}`,e)));Object(c["db"])(()=>e.transferStatus,()=>{e.transferStatus&&(n.value=!1)});const l=Object(c["N"])({username:""}),b={username:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}]},d=(e,t)=>{Object(c["z"])(()=>{const a=document.getElementById("barcode-"+e);a&&t&&!a.hasChildNodes()&&new at.a(a,{text:t,width:80,height:80})})},u=e=>{i["a"].confirm({title:"确定要删除该作品吗？",okText:"删除",okType:"danger",cancelText:"取消",onOk:()=>{t.emit("on-delete",e)}})},p=e=>{t.emit("on-copy",e)},O=e=>{t.emit("on-static",e)},j=e=>{Object(ct["c"])(e)},m=e=>{n.value=!0,o.value=e},f=()=>{r.value.validate().then(()=>{t.emit("on-send",{id:o.value,username:l.username})})};return{deleteClicked:u,copyClicked:p,listWithBarcode:s,showBarcode:d,container:a,staticClicked:O,sendClicked:m,sendModal:n,publishForm:r,rules:b,form:l,sendGift:f,saveImage:j}}});a("6bc0");const ot=D()(nt,[["render",et]]);var rt=ot,st=a("596a"),it=Object(c["r"])({components:{WorksList:rt},setup(){const e=Object(B["b"])(),t=Object(L["e"])(),a=Object(c["i"])(()=>e.state.works.works),n=Object(c["i"])(()=>e.state.works.totalWorks),o=Object(c["i"])(()=>e.state.status.loading),r=Object(c["i"])(()=>e.state.works.statics),s=Object(c["i"])(()=>e.state.editor.channels),i=Object(c["O"])(1),l=Object(c["O"])(!1),b=Object(c["O"])([Object(ct["j"])(Object(ct["k"])(new Date,-30)),Object(ct["j"])(new Date)]),d=Object(c["i"])(()=>Object(ct["d"])(new Date(b.value[0]),new Date(b.value[1]))),u=d.value.map(e=>Object(ct["j"])(e)),p=Object(c["i"])(()=>{const e=r.value.map(e=>e.name),t={type:"category",data:u},a=r.value.map(e=>{const t={};e.list.forEach(e=>{const a=e.eventDate.split("T")[0];t[a]=e.eventData.pv});const a={};return u.forEach(e=>{t[e]?a[e]=t[e]:a[e]=0}),{type:"line",name:e.name,data:Object(ct["g"])(a)}});return{legend:{data:e},xAxis:t,yAxis:{type:"value"},series:a}}),O=[{title:"渠道名称",dataIndex:"name",key:"name"},{title:"PV",dataIndex:"pv",key:"pv"},{title:"占比",dataIndex:"percent",key:"percent"}],j=Object(c["i"])(()=>{let e=0;return r.value.forEach(t=>{const a=t.list.reduce((e,t)=>t.eventData.pv+e,0);e+=a}),e}),m=Object(c["i"])(()=>r.value.map(e=>{const t=e.list.reduce((e,t)=>t.eventData.pv+e,0);return{name:e.name,key:e.id,pv:t,percent:t/j.value*100+"%"}})),f=Object(c["O"])(""),h=Object(c["O"])(!1),g=Object(c["O"])(0),k=Object(c["O"])(0),y=Object(c["i"])(()=>e.state.works.searchText),v=Object(H["a"])();let S;Object(c["G"])(()=>{e.dispatch("fetchWorks")});const w=()=>{const t=f.value.trim();""!==t&&e.dispatch("fetchWorks",{title:t,pageIndex:0,pageSize:8,isTemplate:k.value})},x=()=>{e.dispatch("fetchWorks",{title:"",pageIndex:0,pageSize:8,isTemplate:k.value})},C=t=>{e.dispatch("deleteWork",t)},_=a=>{e.dispatch("copyWork",a).then(({data:e})=>{t.push("/editor/"+e.id)})},q=t=>{e.dispatch("transferWork",t).then(e=>{console.log(e),0!==e.errno?st["a"].error(e.message):(st["a"].success("转赠作品成功"),l.value=!0)})},I=t=>{k.value=t,i.value=1,Object(c["z"])(()=>{e.dispatch("fetchWorks",{title:"",pageIndex:i.value-1,pageSize:8,isTemplate:k.value})})},T=()=>{e.dispatch("fetchWorks",{title:y.value,pageIndex:i.value-1,pageSize:8,isTemplate:k.value})},D=t=>{e.commit("clearStatic"),e.dispatch("getChannels",t).then(()=>{const a=s.value.map(a=>e.dispatch("fetchStatic",{name:a.name,label:t,value:a.id,startDate:b.value[0],endDate:b.value[1]}));return Promise.all(a)}).then(()=>{S.clear(),S.setOption(p.value)})},W=e=>{h.value=!0,g.value=e,D(e)},P=(e,t)=>{b.value[0]=t[0],b.value[1]=t[1],D(g.value)};return{works:a,onDelete:C,onCopy:_,createDesign:v,loading:o,searchText:f,currentSearchText:y,onSearch:w,clearSearch:x,openStatic:W,showModal:h,onDateChange:P,dateRange:b,tableData:m,tableColumns:O,total:n,currentPage:i,pageChange:T,changeCategory:I,sendGift:q,transferDone:l}}});a("7b59");const lt=D()(it,[["render",Be]]);var bt=lt;const dt=e=>(Object(c["M"])("data-v-484486b2"),e=e(),Object(c["K"])(),e),ut={class:"work-detail-container"},pt=["src"],Ot={class:"author"},jt={class:"bar-code-area"},mt=dt(()=>Object(c["n"])("span",null,"扫一扫，手机预览",-1)),ft={ref:"container"},ht={class:"use-button"};function gt(e,t,a,n,o,r){const s=Object(c["S"])("a-col"),i=Object(c["S"])("a-avatar"),l=Object(c["S"])("UserOutlined"),b=Object(c["S"])("a-button"),d=Object(c["S"])("a-row");return Object(c["J"])(),Object(c["m"])("div",ut,[Object(c["q"])(d,{type:"flex",justify:"center"},{default:Object(c["fb"])(()=>[Object(c["q"])(s,{span:8,class:"cover-img"},{default:Object(c["fb"])(()=>[Object(c["n"])("img",{src:e.currentTemplate.coverImg,alt:""},null,8,pt)]),_:1}),Object(c["q"])(s,{span:8},{default:Object(c["fb"])(()=>[Object(c["n"])("h2",null,Object(c["W"])(e.currentTemplate.title),1),Object(c["n"])("p",null,Object(c["W"])(e.currentTemplate.desc),1),Object(c["n"])("div",Ot,[e.currentTemplate.user.picture?(Object(c["J"])(),Object(c["k"])(i,{key:0,src:e.currentTemplate.user.picture},null,8,["src"])):(Object(c["J"])(),Object(c["k"])(i,{key:1},{icon:Object(c["fb"])(()=>[Object(c["q"])(l)]),_:1})),Object(c["p"])(" 该模版由 "),Object(c["n"])("b",null,Object(c["W"])(e.currentTemplate.user.nickName),1),Object(c["p"])(" 创作 ")]),Object(c["n"])("div",jt,[mt,Object(c["n"])("div",ft,null,512)]),Object(c["n"])("div",ht,[Object(c["q"])(b,{type:"primary",size:"large",onClick:t[0]||(t[0]=t=>e.onCopy(e.currentTemplate.id)),loading:e.isCreating},{default:Object(c["fb"])(()=>[Object(c["p"])(Object(c["W"])(e.isCreating?"创建中...":"使用模版"),1)]),_:1},8,["loading"]),Object(c["q"])(b,{size:"large",style:{marginLeft:"20px"},onClick:e.download},{default:Object(c["fb"])(()=>[Object(c["p"])(" 下载图片海报 ")]),_:1},8,["onClick"])])]),_:1})]),_:1})])}var kt=Object(c["r"])({name:"TemplateDetail",components:{},setup(){const e=Object(B["b"])(),t=Object(L["d"])(),a=Object(L["e"])(),n=Object(c["O"])(!1),o=t.params.id,r=Object(c["O"])(null),s=Object(c["i"])(()=>e.getters.getCurrentTemplate(o)||{user:""}),i=Object(c["i"])(()=>`${ca}/p/${s.value.id}-${s.value.uuid}`),l=t=>{e.state.user.isLogin?(n.value=!0,e.dispatch("copyWork",t).then(({data:e})=>{a.push("/editor/"+e.id)})):a.push("/login")},b=()=>{Object(ct["c"])(s.value.coverImg)};return Object(c["G"])(()=>{e.dispatch("fetchTemplate",o).then(()=>{r.value&&new at.a(r.value,{text:i.value,width:120,height:120})})}),{container:r,currentTemplate:s,isCreating:n,onCopy:l,download:b}}});a("1506");const yt=D()(kt,[["render",gt],["__scopeId","data-v-484486b2"]]);var vt=yt;const St={class:"setting-container"},wt=Object(c["n"])("h2",null,"个人中心👤",-1),xt=Object(c["n"])("p",null,"你可以在这里修改昵称和头像",-1);function Ct(e,t,a,n,o,r){const s=Object(c["S"])("styled-uploader"),i=Object(c["S"])("UserOutlined"),l=Object(c["S"])("a-input"),b=Object(c["S"])("a-form-item"),d=Object(c["S"])("a-radio-button"),u=Object(c["S"])("a-radio-group"),p=Object(c["S"])("a-button"),O=Object(c["S"])("a-form"),j=Object(c["S"])("a-col"),m=Object(c["S"])("a-row"),f=Object(c["S"])("a-tab-pane"),h=Object(c["S"])("a-table"),g=Object(c["S"])("a-tabs");return Object(c["J"])(),Object(c["m"])("div",St,[Object(c["q"])(m,{type:"flex",justify:"center"},{default:Object(c["fb"])(()=>[Object(c["q"])(j,{span:16},{default:Object(c["fb"])(()=>[wt,Object(c["q"])(g,{type:"card",activeKey:e.currentKey,"onUpdate:activeKey":t[2]||(t[2]=t=>e.currentKey=t)},{default:Object(c["fb"])(()=>[Object(c["q"])(f,{key:"profile",tab:"修改个人资料"},{default:Object(c["fb"])(()=>[Object(c["q"])(m,{type:"flex",justify:"center"},{default:Object(c["fb"])(()=>[Object(c["q"])(j,{span:12},{default:Object(c["fb"])(()=>[xt,Object(c["q"])(s,{text:"上传封面图",onFileUploaded:e.updateAvatar,uploaded:e.form.uploaded},null,8,["onFileUploaded","uploaded"]),Object(c["q"])(O,{model:e.form,rules:e.rules,ref:"publishForm",layout:"vertical"},{default:Object(c["fb"])(()=>[Object(c["q"])(b,{label:"昵称",required:"",name:"username"},{default:Object(c["fb"])(()=>[Object(c["q"])(l,{value:e.form.username,"onUpdate:value":t[0]||(t[0]=t=>e.form.username=t),placeholder:"填写你的昵称"},{prefix:Object(c["fb"])(()=>[Object(c["q"])(i,{style:{color:"rgba(0,0,0,.25)"}})]),_:1},8,["value"])]),_:1}),Object(c["q"])(b,{label:"性别",name:"username"},{default:Object(c["fb"])(()=>[Object(c["q"])(u,{value:e.form.gender,"onUpdate:value":t[1]||(t[1]=t=>e.form.gender=t)},{default:Object(c["fb"])(()=>[Object(c["q"])(d,{value:"0"},{default:Object(c["fb"])(()=>[Object(c["p"])(" 男 ")]),_:1}),Object(c["q"])(d,{value:"1"},{default:Object(c["fb"])(()=>[Object(c["p"])(" 女 ")]),_:1})]),_:1},8,["value"])]),_:1}),Object(c["q"])(b,null,{default:Object(c["fb"])(()=>[Object(c["q"])(p,{type:"primary",onClick:e.update,size:"large",loading:e.status.loading&&"login"===e.status.opName},{default:Object(c["fb"])(()=>[Object(c["p"])(Object(c["W"])(e.status.loading?"加载中":"更新个人资料"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1}),Object(c["q"])(f,{key:"recover",tab:"恢复删除作品"},{default:Object(c["fb"])(()=>[Object(c["q"])(h,{columns:e.tableColumns,"data-source":e.works,rowKey:"id",pagination:e.pagination,onChange:e.handleTableChange,loading:e.loading},{action:Object(c["fb"])(({text:t,record:a})=>[Object(c["n"])("span",null,[Object(c["q"])(p,{type:"primary",onClick:t=>e.recoverWork(a.id)},{default:Object(c["fb"])(()=>[Object(c["p"])("恢复该作品")]),_:2},1032,["onClick"])])]),_:1},8,["columns","data-source","pagination","onChange","loading"])]),_:1})]),_:1},8,["activeKey"])]),_:1})]),_:1})])}var _t=Object(c["r"])({name:"Setting",components:{},setup(){const e=Object(B["b"])(),t=Object(c["O"])(),a=Object(c["i"])(()=>e.state.user.data),n=Object(c["i"])(()=>e.state.works.works),o=Object(c["i"])(()=>e.state.status.loading),r=Object(c["O"])("profile"),s=Object(c["N"])({pageSize:8,total:0,current:1}),i=Object(c["N"])({username:a.value.nickName||"",gender:a.value.gender||"0",uploaded:{data:{url:a.value.picture||"https://poster-master.oss-cn-guangzhou.aliyuncs.com/upload-files/logo-profile.png"}}}),l=Object(c["i"])(()=>e.state.status),b=[{title:"作品",dataIndex:"title",key:"title"},{title:"ID",dataIndex:"id",key:"id"},{title:"最后更新",dataIndex:"updatedAt",key:"updatedAt"},{title:"操作",key:"action",slots:{customRender:"action"}}],d={username:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}]},u=e=>{i.uploaded={data:{url:e.data.urls[0]}}};Object(c["G"])(()=>{e.dispatch("fetchWorks",{pageIndex:0,pageSize:8,status:0}).then(({data:e})=>{s.total=e.count})});const p=t=>{e.dispatch("recoverWork",t).then(()=>{st["a"].success("作品恢复成功",1)})},O=t=>{s.current=t.current,e.dispatch("fetchWorks",{pageIndex:t.current-1,pageSize:8,status:0})},j=()=>{t.value.validate().then(()=>{const t={nickName:i.username,gender:parseInt(i.gender),picture:i.uploaded.data.url};e.dispatch("updateUserAndFetch",t).then(()=>{st["a"].success("更新信息成功",1)})})};return{form:i,status:l,rules:d,update:j,updateAvatar:u,publishForm:t,works:n,tableColumns:b,recoverWork:p,pagination:s,handleTableChange:O,loading:o,currentKey:r}}});a("42f2");const qt=D()(_t,[["render",Ct]]);var It=qt,Tt=a("4ab4"),Dt=a("21c3"),Wt=a("c368"),Pt=a("ae51");function Jt(e){return Object(Pt["a"])({url:"/works/"+e,method:"get"})}function Lt({data:e,id:t}){return Object(Pt["a"])({url:"/works/"+t,method:"patch",data:e})}const Ut={backgroundColor:"#ffffff",backgroundImage:"",backgroundRepeat:"no-repeat",backgroundSize:"cover",height:"560px"},Et=20,zt=(e,t)=>{-1!==e.historyIndex&&(e.histories=e.histories.slice(0,e.historyIndex),e.historyIndex=-1),e.histories.length<Et||e.histories.shift(),e.histories.push(t)},At=(e,t,a)=>{const{componentId:c,data:n}=t,{key:o,oldValue:r,newValue:s}=n;if(c){const t=e.components.find(e=>e.id===c);Array.isArray(o)?o.forEach((e,c)=>{t.props[e]="undo"===a?r[c]:s[c]}):t.props[o]="undo"===a?r:s}else e.page.props[o]="undo"===a?r:s};let Nt,Mt=0;const Bt=(e,t,a=1e3)=>{Mt&&clearTimeout(Mt),Object(Dt["a"])(Nt)&&(Nt=e),Mt=setTimeout(()=>{t(),Mt=0,Nt=void 0},a)},Rt={state:{components:[],currentElement:"",currentEditing:"",isDirty:!1,isChangedNotPublished:!1,page:{props:Ut,setting:{}},channels:[],histories:[],historyIndex:-1},mutations:{resetEditor(e){e.page={props:Ut,setting:{}},e.components=[],e.histories=[],e.isDirty=!1,e.isChangedNotPublished=!1},addComponentToEditor(e,t){t.id=Object(Tt["a"])(),t.layerName="图层"+(e.components.length+1),e.components.push(t),zt(e,{id:Object(Tt["a"])(),componentId:t.id,type:"add",data:Object(Wt["a"])(t)}),e.isDirty=!0,e.isChangedNotPublished=!0},undo(e){-1===e.historyIndex?e.historyIndex=e.histories.length-1:e.historyIndex--;const t=e.histories[e.historyIndex];switch(t.type){case"add":e.components=e.components.filter(e=>e.id!==t.componentId);break;case"delete":e.components=Object(ct["f"])(e.components,t.index,t.data);break;case"modify":At(e,t,"undo");break;default:break}},redo(e){if(-1===e.historyIndex)return;const t=e.histories[e.historyIndex];switch(t.type){case"add":e.components.push(t.data);break;case"delete":e.components=e.components.filter(e=>e.id!==t.componentId);break;case"modify":At(e,t,"redo");break;default:break}e.historyIndex++},setActive(e,t){e.currentElement=t},setEditing(e,t){e.currentEditing=t},updatePage(e,{key:t,value:a,level:c}){const n=e.page;if(c){if("props"===c){const o=n[c][t];Bt(o,()=>{zt(e,{id:Object(Tt["a"])(),type:"modify",data:{oldValue:Nt,newValue:a,key:t}})})}n[c][t]=a}else n[t]=a;e.isDirty=!0,e.isChangedNotPublished=!0},moveComponent(e,t){const a=e.components.find(t=>t.id===e.currentElement);if(a){const e=this,c=parseInt(a.props.top),n=parseInt(a.props.left),{direction:o,amount:r}=t;switch(o){case"Up":{const t=c-r+"px";e.commit("updateComponent",{key:"top",value:t,isProps:!0});break}case"Down":{const t=c+r+"px";e.commit("updateComponent",{key:"top",value:t,isProps:!0});break}case"Left":{const t=n-r+"px";e.commit("updateComponent",{key:"left",value:t,isProps:!0});break}case"Right":{const t=n+r+"px";e.commit("updateComponent",{key:"left",value:t,isProps:!0});break}default:break}}},updateComponent(e,{id:t,key:a,value:c,isProps:n}){const o=e.components.find(a=>a.id===(t||e.currentElement));if(o){if(n){const n=Array.isArray(a)?a.map(e=>o.props[e]):o.props[a];Bt(n,()=>{zt(e,{id:Object(Tt["a"])(),componentId:t||e.currentElement,type:"modify",data:{oldValue:Nt,newValue:c,key:a}})}),Array.isArray(a)?a.forEach((e,t)=>{o.props[e]=c[t]}):o.props[a]=c}else o[a]=c;e.isDirty=!0,e.isChangedNotPublished=!0}},copyComponent(e,t){const a=e.components.find(e=>e.id===t);a&&(e.copiedComponent=a)},pasteCopiedComponent(e){if(e.copiedComponent){const t=Object(Wt["a"])(e.copiedComponent);t.id=Object(Tt["a"])(),t.layerName=t.layerName+"副本",e.components.push(t),e.isDirty=!0,e.isChangedNotPublished=!0,zt(e,{id:Object(Tt["a"])(),componentId:t.id,type:"add",data:Object(Wt["a"])(t)})}},deleteComponent(e,t){const a=e.components.find(e=>e.id===t),c=e.components.findIndex(e=>e.id===t);e.components=e.components.filter(e=>e.id!==t),zt(e,{id:Object(Tt["a"])(),componentId:a.id,type:"delete",data:a,index:c}),e.isDirty=!0,e.isChangedNotPublished=!0},getWork(e,{data:t}){const{content:a,...c}=t;e.page={...e.page,...c},a.props&&(e.page.props={...e.page.props,...a.props}),a.setting&&(e.page.setting={...e.page.setting,...a.setting}),e.components=a.components},getChannels(e,{data:t}){e.channels=t.list},createChannel(e,{data:t}){e.channels=[...e.channels,t]},deleteChannel(e,{extraData:t}){e.channels=e.channels.filter(e=>e.id!==t.id)},saveWork(e){e.isDirty=!1,e.page.updatedAt=(new Date).toISOString()},copyWork(e){e.page.updatedAt=(new Date).toISOString()},publishWork(e){e.isChangedNotPublished=!1,e.page.latestPublishAt=(new Date).toISOString()},publishTemplate(e){e.page.isTemplate=!0}},actions:{getWork({commit:e},t){return Jt(t).then(t=>e("getWork",t))},getChannels({commit:e},t){return Qt("/channel/getWorkChannels/"+t,"getChannels",e)},createChannel({commit:e},t){return Qt("/channel","createChannel",e,{method:"post",data:t})},deleteChannel({commit:e},t){return Qt("channel/"+t,"deleteChannel",e,{method:"delete"},{id:t})},saveWorkT({commit:e,state:t},a){const{id:c,data:n}=a;if(!n){const{title:e,desc:a,props:n,coverImg:o,setting:r}=t.page,s={title:e,desc:a,coverImg:o,content:{components:t.components,props:n,setting:r}};return Lt({id:c,data:s})}},copyWork({commit:e},t){return Qt("/works/copy/"+t,"copyWork",e,{method:"post"})},publishWork({commit:e},t){return Qt("/works/publish/"+t,"publishWork",e,{method:"post"})},publishTemplate({commit:e},t){return Qt("/works/publish-template/"+t,"publishTemplate",e,{method:"post"})},saveAndPublishWork({dispatch:e,state:t},a){const{id:c}=t.page;return e("saveWork",a).then(()=>e("publishWork",c)).then(()=>e("getChannels",c)).then(()=>0===t.channels.length?e("createChannel",{name:"默认",workId:c}):Promise.resolve({}))}},getters:{getCurrentElement:e=>e.components.find(t=>t.id===e.currentElement),checkUndoDisable:e=>0===e.histories.length||0===e.historyIndex,checkRedoDisable:e=>0===e.histories.length||e.historyIndex===e.histories.length||-1===e.historyIndex}};var Ht=Rt,Ft=a("8dbf");const Gt={state:{isLogin:!1,data:{},token:localStorage.getItem("token")||""},mutations:{login(e,t){const{token:a}=t.data;e.token=a,localStorage.setItem("token",a),Pt["a"].defaults.headers.common.Authorization="Bearer "+a},fetchCurrentUser(e,t){e.isLogin=!0,e.data={...t.data}},logout(e){e.token="",e.isLogin=!1,localStorage.removeItem("token"),delete n["a"].defaults.headers.common.Authorization},updateUser(e,{data:t,extraData:a}){const{token:c}=t.data;e.data={...e.data,...a},e.token=c,localStorage.setItem("token",c),Pt["a"].defaults.headers.common.Authorization="Bearer "+c}},actions:{login:({commit:e},t)=>Object(Ft["c"])(t).then(t=>{e("login",t)}),fetchCurrentUser:({commit:e})=>Object(Ft["a"])().then(t=>e("fetchCurrentUser",t)),loginAndFetch({dispatch:e},t){return e("login",t).then(()=>e("fetchCurrentUser"))},updateUser({commit:e},t){Object(Ft["d"])(t).then(t=>{e("updateUser",t)})},updateUserAndFetch({dispatch:e},t){return e("updateUser",t).then(()=>e("fetchCurrentUser"))}}};var $t=Gt;function Kt(e){return Object(Pt["a"])({url:"/works",method:"get",params:{...e}})}const Vt={state:{templates:[],works:[],totalWorks:0,statics:[],totalTemplates:0,searchText:""},mutations:{fetchTemplates(e,{data:t,extraData:a}){const{pageIndex:c,searchText:n}=a,{list:o,count:r}=t.data;e.templates=0===c?o:[...e.templates,...o],e.totalTemplates=r,e.searchText=n||""},fetchTemplate(e,{data:t}){e.templates=[t]},fetchWorks(e,{data:t,extraData:a}){const{pageIndex:c,searchText:n}=a,{list:o,count:r}=t.data;e.works=o,e.totalWorks=r,e.searchText=n||""},createWork(e,{data:t}){e.works.unshift(t)},deleteWork(e,{extraData:t}){e.works=e.works.filter(e=>e.id!==t.id)},recoverWork(e,{extraData:t}){e.works=e.works.filter(e=>e.id!==t.id)},transferWork(e,{data:t,extraData:a}){0===t.errno&&(e.works=e.works.filter(e=>e.id!==a.id))},fetchStatic(e,{data:t,extraData:a}){const c=t.data,{name:n,id:o}=a;e.statics.push({name:n,id:o,list:c})},clearStatic(e){e.statics=[]}},actions:{fetchTemplates({commit:e},t={pageIndex:0,pageSize:8,title:""}){t.title||delete t.title;const a=Object(ct["h"])(t);return Qt("/templates?"+a,"fetchTemplates",e,{method:"get"},{pageIndex:t.pageIndex,searchText:t.title})},fetchTemplate({commit:e},t){return Qt("/templates/"+t,"fetchTemplate",e)},fetchWorks({commit:e},t={pageIndex:0,pageSize:8,title:""}){t.title||delete t.title,Kt(t).then(a=>{e("fetchWorks",{data:a,extraData:{pageIndex:t.pageIndex,searchText:t.title}})})},deleteWork({commit:e},t){return Qt("/works/"+t,"deleteWork",e,{method:"delete"},{id:t})},createWork({commit:e},t){return Qt("/works","createWork",e,{method:"post",data:t})},fetchStatic({commit:e},t){const a={category:"h5",action:"pv",...t},c=Object(ct["h"])(a);return Qt(`${na}/api/event?${c}`,"fetchStatic",e,{method:"get"},{name:t.name,id:t.label})},recoverWork({commit:e},t){return Qt("/works/put-back/"+t,"recoverWork",e,{method:"post"},{id:t})},transferWork({commit:e},{id:t,username:a}){return Qt(`/works/transfer/${t}/${a}`,"transferWork",e,{method:"post"},{id:t})}},getters:{getCurrentTemplate:e=>t=>e.templates.find(e=>e.id===parseInt(t))}};var Yt=Vt;const Qt=async(e,t,a,c={method:"get"},o)=>{const r={...c,mutationName:t},{data:s}=await Object(n["a"])(e,r);return a(t,o?{data:s,extraData:o}:s),s};var Zt=Object(B["a"])({state:{user:{},status:{loading:!1,error:{status:!1,message:""},opName:""},editor:{},works:{}},mutations:{setLoading(e,{status:t,opName:a}){e.status.loading=t,a&&(e.status.opName=a)},setError(e,t){e.status.error=t}},modules:{editor:Ht,user:$t,works:Yt}});const Xt=[{path:"/",name:"Index",component:K,children:[{path:"",name:"Home",component:Ue,meta:{title:"欢迎来到慕课乐高"}},{path:"mywork",name:"MyWork",component:bt,meta:{requiredLogin:!0,title:"我的设计列表"}},{path:"/template/:id",name:"TemplateDetail",component:vt,meta:{title:"模版详情"}},{path:"setting",name:"Setting",component:It,meta:{requiredLogin:!0,title:"我的信息"}}]},{path:"/editor/:id",name:"Editor",component:()=>Promise.all([a.e("npm..pnpm"),a.e("editor")]).then(a.bind(null,"49d7")),meta:{requiredLogin:!0,title:"编辑我的设计"}},{path:"/login",name:"Login",component:()=>a.e("login").then(a.bind(null,"a55b")),meta:{redirectAlreadyLogin:!0,title:"登录到慕课乐高"}}],ea=Object(L["a"])({history:Object(L["b"])(),routes:Xt,scrollBehavior:(e,t,a)=>a||Promise.resolve({left:0,top:0})});ea.beforeEach((e,t,a)=>{const{user:c}=Zt.state,{token:n,isLogin:o}=c,{requiredLogin:r,redirectAlreadyLogin:s,title:i}=e.meta;console.log("token",n),i&&(document.title=i),o?s?a("/"):a():n?Zt.dispatch("fetchCurrentUser").then(e=>{a()}).catch(e=>{console.error(e),Zt.commit("logout"),a("login")}):r?a("login"):a()});var ta=ea;let aa="",ca="",na="";Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_IS_STAGING?(aa="http://182.92.168.192:8081",ca="http://182.92.168.192:8082",na="http://182.92.168.192:8080"):(aa="https://api.imooc-lego.com",ca="https://h5.imooc-lego.com",na="https://statistic-res.imooc-lego.com"),n["a"].defaults.baseURL=aa+"/api/";const oa=Object(c["j"])(J);let ra=0,sa="";n["a"].interceptors.request.use(e=>{const t=e;Zt.commit("setLoading",{status:!0,opName:t.mutationName}),Zt.commit("setError",{status:!1,message:""}),ra=Date.now();const{baseURL:a,url:c}=e;return sa=`${null===a||void 0===a?void 0:a.slice(0,-1)}${c}`,e}),n["a"].interceptors.response.use(e=>(Zt.commit("setLoading",{status:!1}),0!==e.data.errno?(Zt.commit("setError",{status:!0,message:e.data.message}),Promise.reject(e.data)):(ra=Date.now()-ra,window.__bl&&window.__bl.api&&window.__bl.api(sa,!0,ra,0,e.data.message),e)),e=>{const t=e.response?e.response.data:e.message;return Zt.commit("setError",{status:!0,message:t}),Zt.commit("setLoading",{status:!1}),ra=Date.now()-ra,window.__bl&&window.__bl.api&&window.__bl.api(sa,!1,ra,-1,t),Promise.reject(t)}),oa.use(Zt).use(ta).use(C).use(_["a"]),oa.mount("#app")},cf05:function(e,t,a){e.exports=a.p+"img/logo.c95a9800.png"},ebac:function(e,t,a){},f7f2:function(e,t,a){"use strict";a("558b");var c=a("b6f3"),n=a("3955"),o=a("9a86");function r(){const e=Object(c["b"])(),t=Object(o["e"])(),a=Object(n["i"])(()=>e.state.user),r=()=>{if(a.value.isLogin){const a={title:"未命名作品",desc:"未命名作品",coverImg:"http://typescript-vue.oss-cn-beijing.aliyuncs.com/vue-marker/5f81cca3f3bf7a0e1ebaf885.png"};e.dispatch("createWork",a).then(({data:e})=>{t.push("/editor/"+e.id)})}else t.push("/login")};return r}t["a"]=r}});
//# sourceMappingURL=app.73dd3822.js.map